#include "ui.h"

#include <zephyr/kernel.h>
#include <string.h>

#include "display.h"
#include "font.h"

#define UI_ELEMENT_WIDTH 32
#define UI_ELEMENT_HEIGHT 4

int ui_init()
{
    return display_init();
}

// Comine images of full size horizontally
void combine_images(const unsigned char *top, const unsigned char *bottom, unsigned char *dst)
{
    // assume top, bottom are both 512 bytes
    memcpy(dst, top, HALF_BUFFER);
    memcpy(dst + HALF_BUFFER, bottom, HALF_BUFFER);
}

unsigned char buffer_heart[128] = {
    0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    0xC0, 0x80, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0xE0, 0xE0, 0xE0, 0xE0,
    0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0F, 0x1F,
    0x3F, 0x7F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0x7F, 0x3F, 0x1F, 0x0F, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
    0x03, 0x07, 0x0F, 0x1F, 0x0F, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_heart = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_heart
};

unsigned char buffer_bat[128] = {
    0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xE0, 0xC0, 0xC0, 0xC0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xFC, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFE, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFC, 0xF0, 0x00, 0x00, 0x00, 0x3F, 0x0F, 0x03, 0x01, 0x01, 0x01, 0x01,
    0x03, 0x1F, 0x0F, 0x0F, 0x0F, 0x1F, 0x7F, 0xFF, 0x7F, 0x1F, 0x0F, 0x0F,
    0x0F, 0x1F, 0x03, 0x01, 0x01, 0x01, 0x01, 0x03, 0x0F, 0x3F, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_bat = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_bat
};

unsigned char buffer_one[128] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0,
    0xC0, 0xE0, 0xE0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_one = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_one
};

unsigned char buffer_two[128] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xC0,
    0x60, 0x60, 0x60, 0x60, 0x60, 0xE0, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xC1, 0xFF, 0x7F, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0xC0, 0xE0, 0xF0, 0xB8, 0x9C, 0x8E, 0x87, 0x83, 0x81,
    0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_two = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_two
};

unsigned char buffer_three[128] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
    0xC0, 0x60, 0x70, 0x70, 0x70, 0x70, 0xF0, 0xE0, 0xC0, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x60,
    0xE0, 0xF0, 0xF8, 0xDF, 0x87, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x81, 0xC3,
    0x7F, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_three = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_three
};

unsigned char buffer_four[128] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0xC0, 0xE0, 0xE0, 0xE0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0x78, 0x1E, 0x07, 0x03, 0x00,
    0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F,
    0x0F, 0x0F, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0xFF, 0xFF, 0xFF, 0x0C,
    0x0C, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_four = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_four
};

unsigned char buffer_five[128] = {
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0,
    0xF0, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x10, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x1F, 0x18, 0x18, 0x18,
    0x38, 0x38, 0x70, 0xE0, 0xC0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0xC0, 0xE0, 0x70,
    0x3F, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03,
    0x03, 0x03, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

struct Image image_five = {
    .width = 32,
    .height = 4,
    .size = 128,
    .buffer = buffer_five
};

unsigned char buffer_dracula[445] = {
    0x07, 0x7E, 0xF8, 0xF8, 0x30, 0x30, 0x20, 0x60, 0x40, 0xC0, 0x80, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x60, 0x60, 0xE0, 0xC0,
    0xCE, 0x9C, 0x78, 0xD0, 0xF0, 0xD0, 0x78, 0x9C, 0xCE, 0xC0, 0xE0, 0x60,
    0x60, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0xF8,
    0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0xFE, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0x00, 0x01, 0x13, 0x1A, 0x06, 0x07, 0x1A, 0x12,
    0x03, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00,
    0x00, 0x00, 0xF0, 0xE0, 0x60, 0x60, 0x60, 0x60, 0x40, 0xC0, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x80, 0xE0, 0x70, 0x70, 0x30, 0x30, 0x30, 0x60, 0xE0,
    0xC0, 0x00, 0x00, 0x00, 0x80, 0xC0, 0xE0, 0x30, 0x30, 0x30, 0x30, 0x70,
    0xE0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0xE0, 0x70, 0x70, 0x30, 0x30, 0x30,
    0x60, 0xE0, 0xC0, 0x00, 0xF0, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xE0, 0x7F, 0x1F, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0x60, 0x60, 0xE0,
    0xF0, 0x30, 0x1F, 0x0F, 0x00, 0x00, 0x00, 0xE1, 0xF1, 0x38, 0x18, 0x18,
    0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0x81,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF,
    0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xF0, 0xFF, 0xFF, 0x00, 0x00,
    0x00, 0x00, 0xFF, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0xE1, 0xF1, 0x38,
    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF, 0x1C, 0x0F, 0x07, 0x07,
    0x02, 0x02, 0x02, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1E,
    0x0F, 0x00, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0C, 0x00, 0x00, 0x00, 0x00,
    0x07, 0x0F, 0x0E, 0x0C, 0x0C, 0x0C, 0x0C, 0x06, 0x07, 0x0F, 0x0F, 0x00,
    0x00, 0x00, 0x00, 0x03, 0x07, 0x0E, 0x0C, 0x0C, 0x0C, 0x0E, 0x07, 0x03,
    0x00, 0x00, 0x00, 0x00, 0x03, 0x0F, 0x0C, 0x0C, 0x0C, 0x0E, 0x07, 0x03,
    0x00, 0x0F, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x00, 0x00,
    0x00, 0x00, 0x07, 0x0F, 0x0E, 0x0C, 0x0C, 0x0C, 0x0C, 0x06, 0x07, 0x0F, 0x0F
};

struct Image image_dracula = {
    .width = 89,
    .height = 5,
    .size = 445,
    .buffer = buffer_dracula
};

unsigned char buf[1024];
struct Image image_combined = {
    .width = 128,
    .height = 8,
    .size = 1024,
    .buffer = buf
};


/*That room is not adjacent.
Done - Dracula is in that room.
Done - Dracula is not in that room.
Done - You have no more water.
Done - You have no more light.
Done - Player {number} has been bitten.
Done - You can't move again on your turn.
Done - You have no more garlic.
Done - Incorrect token resource to gain.
Done - Player {number} turn to move*/
const char ab1[] = "dracula is"; //offset 64
const char a2[] = "in that"; //offset 74
const char a3[] = "room"; //offset 80
const char b2[] = "not in"; //offset 76
const char b3[] = "that room"; //offset 68
const char cde1[] = "you have"; //offset 70
const char cde2[] = "no more"; //offset 74
const char c3[] = "holy water"; //offset 64
const char d3[] = "sunlight"; //offset 70
const char e3[] = "garlic"; //offset 76
const char p1[] = "player 1"; //offset 70
const char p2[] = "player 2"; //offset 70
const char p3[] = "player 3"; //offset 70
const char p4[] = "player 4"; //offset 70
const char f1[] = "already"; //offset 74
const char f2[] = "moved"; //offset 78
const char f3[] = "this turn"; //offset 68
const char g2[] = "turn to"; //offset 74
const char g3[] = "move"; //offset 80
const char h1[] = "invalid"; //offset 74
const char h2[] = "resource"; //offset 70
const char h3[] = "type"; //offset 80
const char i2[] = "has been"; //offset 70
const char i3[] = "bitten"; //offset 76
const char j1[] = "valid"; //offset 78
const char j2[] = "action"; //offset 76
const char k1[] = "too many"; //offset 70
const char k2[] = "actions"; //offset 74
const char l1[] = "that room"; //offset 68
const char l2[] = "is not"; //offset 76
const char l3[] = "adjacent"; //offset 70

void err_not_adjacent()
{
    display_string(l1, 68, 1);
    display_string(l2, 76, 3);
    display_string(l3, 70, 5);
}
void mes_dracula()
{
    display_string(ab1, 64, 1);
    display_string(a2, 74, 3);
    display_string(a3, 80, 5);
}

void mes_no_dracula()
{
    display_string(ab1, 64, 1);
    display_string(b2, 76, 3);
    display_string(b3, 68, 5);
}

void err_no_water()
{
    display_string(cde1, 70, 1);
    display_string(cde2, 74, 3);
    display_string(c3, 64, 5);
}

void err_no_light()
{
    display_string(cde1, 70, 1);
    display_string(cde2, 74, 3);
    display_string(d3, 70, 5);
}

void err_no_garlic()
{
    display_string(cde1, 70, 1);
    display_string(cde2, 74, 3);
    display_string(e3, 76, 5);
}

void err_already_moved()
{
    display_string(f1, 74, 1);
    display_string(f2, 78, 3);
    display_string(f3, 68, 5);
}

void err_not_your_turn(int player)
{
    switch (player)
    {
        case 1: display_string(p1, 70, 1); break;
        case 2: display_string(p2, 70, 1); break;
        case 3: display_string(p3, 70, 1); break;
        case 4: display_string(p4, 70, 1); break;
    }

    display_string(g2, 74, 3);
    display_string(g3, 80, 5);
}

void err_invalid_resource()
{
    display_string(h1, 74, 1);
    display_string(h2, 70, 3);
    display_string(h3, 80, 5);
}

void mes_player_bitten(int player)
{
    switch (player)
    {
        case 1: display_string(p1, 70, 1); break;
        case 2: display_string(p2, 70, 1); break;
        case 3: display_string(p3, 70, 1); break;
        case 4: display_string(p4, 70, 1); break;
    }

    display_string(i2, 70, 3);
    display_string(i3, 76, 5);
}

void mes_valid_action()
{
    display_string(j1, 78, 2);
    display_string(j2, 76, 4);
}

void err_too_many_actions()
{
    display_string(k1, 70, 2);
    display_string(k2, 74, 4);
}

void display_health(int player_lives, int dracula_lives)
{
    display_image(&image_heart, 0, 0);

    switch (player_lives)
    {
        case 1: display_image(&image_one, 32, 0); break;
        case 2: display_image(&image_two, 32, 0); break;
        case 3: display_image(&image_three, 32, 0); break;
        case 4: display_image(&image_four, 32, 0); break;
        case 5: display_image(&image_five, 32, 0); break;
    }

    display_image(&image_bat, 0, 4);

    switch (dracula_lives)
    {
        case 1: display_image(&image_one, 32, 4); break;
        case 2: display_image(&image_two, 32, 4); break;
        case 3: display_image(&image_three, 32, 4); break;
    }
}

void ui_splash()
{
    display_image(&image_dracula, 20, 2);
    k_msleep(10000);
}